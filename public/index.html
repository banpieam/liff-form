<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Redirecting...</title>
<script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
<script>
async function main() {
  try {
    console.log("üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏° init LIFF");
    await liff.init({ liffId: "2007830171-P7b3veqm" });
    console.log("‚úÖ LIFF init ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß");

    if (!liff.isLoggedIn()) {
      console.log("‚ö†Ô∏è ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà login ‚Üí login ‡∏û‡∏£‡πâ‡∏≠‡∏° redirect");
      liff.login({ redirectUri: window.location.href });
      return;
    }

    console.log("üîç ‡∏î‡∏∂‡∏á decoded ID token");
    let idToken = liff.getDecodedIDToken();
    console.log("üìÑ ID Token:", idToken);

    if (!idToken) {
      console.warn("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ ID Token ‚Üí ‡∏•‡∏≠‡∏á reload");
      window.location.reload();
      return;
    }

    const userId = idToken.sub;
    console.log("üë§ User ID:", userId);

    const formURL = "https://docs.google.com/forms/d/e/1FAIpQLSfp15FY492z_zaFAbPP0Wz4YPs_ivmGLCTGBeQPI4LixAqdDQ/viewform";
    const prefilled = `${formURL}?usp=pp_url&entry.861531766=${encodeURIComponent(userId)}`;
    console.log("‚û°Ô∏è Redirect ‡πÑ‡∏õ:", prefilled);

    window.location.replace(prefilled);
  } catch (error) {
    console.error("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", error);
    document.body.innerHTML = `<p style="color:red;">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}</p>`;
  }
}
main();
</script>
</head>
<body>
<p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°...</p>
</body>
</html>
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Redirecting...</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    async function main() {
      try {
        console.log("üöÄ Starting LIFF init...");
        await liff.init({ liffId: "2007830171-P7b3veqm" });
        console.log("‚úÖ LIFF init complete");

        if (!liff.isLoggedIn()) {
          console.log("‚ö†Ô∏è Not logged in, redirecting to login...");
          liff.login({ redirectUri: window.location.href });
          return;
        }

        console.log("üîë Getting ID Token...");
        const idToken = liff.getDecodedIDToken();
        console.log("Decoded ID Token:", idToken);

        const userId = idToken.sub;
        console.log("üë§ User ID:", userId);

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏•‡∏¥‡∏á‡∏Å‡πå Google Form ‡∏û‡∏£‡πâ‡∏≠‡∏° Prefill
        const formURL = "https://docs.google.com/forms/d/e/1FAIpQLSfp15FY492z_zaFAbPP0Wz4YPs_ivmGLCTGBeQPI4LixAqdDQ/viewform";
        const prefilled = `${formURL}?usp=pp_url&entry.861531766=${encodeURIComponent(userId)}`;

        console.log("üìÑ Redirecting to form:", prefilled);
        window.location.href = prefilled;

      } catch (error) {
        console.error("‚ùå Error during LIFF process:", error);
        document.body.innerHTML = `<p style="color:red;">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}</p>`;
      }
    }
    main();
  </script>
</head>
<body>
  <p>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏ü‡∏≠‡∏£‡πå‡∏°...</p>
</body>
</html>
